<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>run21</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
  </head>
  <body>
    <div class="container">
        <div class="jumbotron">
            <h1 class="display-3">Run21</h1>
            <p class="lead">A healthy competition of three VillaRunners trying to reach in the first place to the glory of the 2021kms in 2021!</p>
            <hr class="my-2">
            <!--<p class="lead">
              <a class="btn btn-primary btn-lg" href="#" role="button">Rules</a>
            </p>-->
            <div class="row">
              <div class="col-2">
             
                <select id="sltMonths" class="form-select" aria-label="Default select example">
                  <option value="all" selected>ALL MONTHS</option>
                  <option value="jan">JANUARY</option>
                  <option value="fev">FEBRUARY</option>
                  <option value="mar">MARCH</option>
                  <option value="apr">APRIL</option>
                  <option value="may">MAY</option>
                  <option value="jun">JUNE</option>
                  <option value="jul">JULY</option>
                  <option value="aug">AUGUST</option>
                  <option value="sep">SEPTEMBER</option>
                  <option value="oct">OCTOBER</option>
                  <option value="nov">NOVEMBER</option>
                  <option value="dec">DECEMBER</option>
                </select></div>
            </div>
            
            <p class="lead">
                <div class="progress mb-2" style="height: 70px;">
                    <div id="fq" class="progress-bar bg-info" role="progressbar" style="width: 0%" >JORGE</div>
                  </div>
                <div class="progress mb-2" style="height: 70px;">
                    <div id="rq" class="progress-bar bg-danger" role="progressbar" style="width: 0%" >RICKY</div>
                    
                  </div>
                  <div class="progress" style="height: 70px;">
                    <div id="bm" class="progress-bar bg-warning" role="progressbar" style="width: 0%" >BRUNO</div>
                  </div>
                  
            </p>
            <form class="row row-cols-lg-auto g-3 align-items-center">
                <div class="col-12">
                  <label class="visually-hidden" for="inlineFormInputGroupUsername">secret</label>
                  <div class="input-group">
                    <input type="text" class="form-control" id="txtSecret" placeholder="secret">
                  </div>
                </div>
                <div class="col-12">
                    <label class="visually-hidden" for="inlineFormInputGroupUsername">kms</label>
                    <div class="input-group">
                      <input type="number" class="form-control" id="txtKm" placeholder="kms">
                    </div>
                  </div>
                <div class="col-12">
                  <button type="submit" class="btn btn-primary">run for it!</button>
                </div>
              </form>
        </div>
        <br>
        <table class="table table-sm">
          <thead>
            <tr>
              <th scope="col">KMS</th>
              <th scope="col">JAN</th>
              <th scope="col">FEB</th>
              <th scope="col">MAR</th>
              <th scope="col">APR</th>
              <th scope="col">MAY</th>
              <th scope="col">JUN</th>
              <th scope="col">JUL</th>
              <th scope="col">AUG</th>
              <th scope="col">SEP</th>
              <th scope="col">OCT</th>
              <th scope="col">NOV</th>
              <th scope="col">DEC</th>                            
              <th scope="col">200k</th>
              <th scope="col">400k</th>
              <th scope="col">600k</th>
              <th scope="col">800k</th>
              <th scope="col">1000k</th>
              <th scope="col">1200k</th>
              <th scope="col">1400k</th>
              <th scope="col">1600k</th>
              <th scope="col">1800k</th>
              <th scope="col">2000k</th>
              <th scope="col">TOTAL</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <th scope="row">JORGE</th>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>0 pts</td>
            </tr>
            <tr>
              <th scope="row">RICKY</th>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>0 pts</td>
            </tr>
            <tr class="table-success">
              <th scope="row">BRUNO</th>
              <td>-
                <!--<img src="images/medal.png" style="width:25px; height:25px" alt="">-->
              </td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>3</td>             
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>-</td>
              <td>3 pts</td>
            </tr>
          </tbody>
        </table>
        
    </div>

    


    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.2.2/firebase-firestore.js"></script>

    <script>
      // Your web app's Firebase configuration
      // For Firebase JS SDK v7.20.0 and later, measurementId is optional
      var firebaseConfig = {
        apiKey: "AIzaSyBu4hR3FlHyJnF7qC7frBXy6GI0niDYWc0",
        authDomain: "run21-bba82.firebaseapp.com",
        projectId: "run21-bba82",
        storageBucket: "run21-bba82.appspot.com",
        messagingSenderId: "763782590038",
        appId: "1:763782590038:web:c7a5cfa6e85f9c54c015f7",
        measurementId: "G-MT7M3SHN5C",
      };
      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      firebase.analytics();

      const db = firebase.firestore();
      const docRef = db.collection("runners");
      
      
      document.querySelector('#sltMonths').addEventListener('change', ()=> {
        getData();
      })
      
      getData()

      function getData() {
        console.log('entrei');
        docRef.get().then(function (doc) {
        doc.forEach(function(doc) {
            const data = doc.data()
            const month = document.querySelector('#sltMonths').value
            let kms
            if(month == 'all') {
              kms = data.kms
            } else {
              kms = data[month]
            }
            document.querySelector(`#${doc.id}`).innerHTML = `${data.name}<br>${kms} kms<br>${(kms/2021*100).toFixed(2)}%`
            document.querySelector(`#${doc.id}`).style.width = `${kms/2021*100}%`

        });
    })
    .catch(function(error) {
        console.log("Error getting documents: ", error);
    });
       
      }

      


        document.querySelector('form').addEventListener('submit', (event) => {
            event.preventDefault()

            const txtSecret = document.querySelector('#txtSecret').value
            const txtKm = +document.querySelector('#txtKm').value


            docRef.get().then(function (doc) {
                let found = false
                doc.forEach(function(doc) {
                const data = doc.data()
                if(data.secret === txtSecret) {
                    //const newValue = data.kms + txtKm
                    const monthNames = ["jan", "feb", "mar", "apr", "may", "jun", "jul", "aug", "sep", "oct", "nov", "dec"];
            
                    const month = monthNames[new Date().getMonth()]
                    const valueMonth = data[month] + txtKm                    
                    doc.ref.update({[month]: valueMonth})
                    const acum = data.kms + txtKm                    
                    doc.ref.update({kms: acum})
                    

                    found=true
                    setTimeout(function(){ location.reload() }, 1000);
                    
                    
                }
                
                });
                if(!found) {
                    alert('Secret not found!');
                }
            })
            .catch(function(error) {
                console.log("Error getting documents: ", error);
            });
           
        })


    </script>
  </body>
</html>
